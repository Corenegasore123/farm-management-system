{% extends 'attendance/base.html' %}
{% block title %} Mark Attendance â€” FarmEase {% endblock %}
{% block page_title %}Mark Attendance{% endblock %}
{% block content %}
<div class="mb-6">
  <h2 class="text-2xl font-bold text-gray-800 mb-1">Mark Student Attendance</h2>
  <p class="text-gray-500 text-sm">Choose a date and mark students as present or absent</p>
</div>

<div class="bg-blue-50 rounded-lg p-6 mb-6 border border-blue-300">
  <form method="get" class="flex items-center gap-3 mb-4">
    <div class="flex-1 max-w-xs">
      <label class="block text-sm font-semibold text-gray-700 mb-2">Select Date</label>
      <input type="date" name="date" value="{{ date|date:'Y-m-d' }}" class="form-control w-full" />
    </div>
    <div class="flex gap-2 mt-7">
      <button class="btn btn-outline inline-flex items-center gap-2" type="submit">
        <i class="bi bi-calendar2-check"></i>
        <span>Load Date</span>
      </button>
      <a class="btn btn-outline inline-flex items-center gap-2" href="{% url 'mark_attendance' %}">
        <i class="bi bi-arrow-clockwise"></i>
        <span>Today</span>
      </a>
    </div>
  </form>
  
  <!-- Bulk Actions -->
  <div class="pt-4 border-t border-blue-200">
    <p class="text-sm font-semibold text-gray-700 mb-2">Bulk Actions:</p>
    <div class="flex gap-2">
      <form method="post" action="{% url 'bulk_mark_attendance' %}" class="inline">
        {% csrf_token %}
        <input type="hidden" name="date" value="{{ date|date:'Y-m-d' }}" />
        <input type="hidden" name="action" value="present" />
        <button type="submit" class="btn btn-outline inline-flex items-center gap-2 text-green-600 border-green-300 hover:bg-green-50">
          <i class="bi bi-check-all"></i>
          <span>Mark All Present</span>
        </button>
      </form>
      <form method="post" action="{% url 'bulk_mark_attendance' %}" class="inline">
        {% csrf_token %}
        <input type="hidden" name="date" value="{{ date|date:'Y-m-d' }}" />
        <input type="hidden" name="action" value="absent" />
        <button type="submit" class="btn btn-outline inline-flex items-center gap-2 text-red-600 border-red-300 hover:bg-red-50">
          <i class="bi bi-x-lg"></i>
          <span>Mark All Absent</span>
        </button>
      </form>
    </div>
  </div>
</div>

<form method="post">
  {% csrf_token %}
  <input type="hidden" name="date" value="{{ date|date:'Y-m-d' }}" />

  <div class="bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm mb-6">
    <table class="table w-full">
      <thead>
        <tr>
          <th class="text-left">Student</th>
          <th class="text-left">Class</th>
          <th class="text-center">Present</th>
        </tr>
      </thead>
      <tbody>
        {% for s, present in rows %}
        <tr>
          <td>
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-full bg-blue-400 flex items-center justify-center text-white font-semibold">
                {{ s.name|first|upper }}
              </div>
              <span class="font-medium text-gray-800">{{ s.name }}</span>
            </div>
          </td>
          <td>
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700">{{ s.class_name }}</span>
          </td>
          <td class="text-center">
            <label class="inline-flex items-center gap-3 cursor-pointer">
              <input type="checkbox" name="present_{{ s.id }}" {% if present %}checked{% endif %} class="w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2 cursor-pointer" />
              {% if present %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-green-100 text-green-800">
                  <i class="bi bi-check-circle-fill mr-1"></i>Present
                </span>
              {% else %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-600">
                  <i class="bi bi-dash-circle mr-1"></i>Absent
                </span>
              {% endif %}
            </label>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="py-16 text-center">
            <div class="empty-state inline-block">
              <i class="bi bi-mortarboard text-gray-400 text-4xl mb-3 block"></i>
              <p class="text-gray-500 font-medium">No students available</p>
              <p class="text-gray-400 text-sm mt-1">Add students to mark attendance</p>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="flex justify-end gap-3">
    <a href="/attendance/students/" class="btn btn-outline inline-flex items-center gap-2">
      <i class="bi bi-arrow-left"></i>
      <span>Back to Students</span>
    </a>
    <button type="submit" class="btn btn-primary inline-flex items-center gap-2">
      <i class="bi bi-save2"></i>
      <span>Save Attendance</span>
    </button>
  </div>
</form>
{% endblock %}
